context("rhat")

test_that("rhat.matrix", {
  matrix <- matrix(1, nrow = 2, ncol = 100)
  expect_identical(rhat(matrix), 1)
  matrix[1,] <- 2
  expect_true(is.infinite(rhat(matrix)))
    matrix[1,1] <- NA
  expect_true(is.na(rhat(matrix)))
})

test_that("rhat.mcmcmarray", {
  expect_identical(rhat(mcmcr[[1]], by = "term"), c(1, 1))

  expect_equivalent(rhat(mcmcr[[2]], by = "term"), matrix(c(1.85, 1.85, 1.87, 1.87), nrow = 2, ncol = 2))
  expect_identical(rhat(mcmcr[[3]], by = "term"), c(1))
  expect_identical(rhat(mcmcr[[2]]), c(1.87))
  expect_identical(rhat(mcmcr[[1]], "parameter"), rhat(mcmcr[[1]], "all"))
})

test_that("rhat.mcmcr", {
  expect_identical(rhat(mcmcr), 1.87)
  expect_identical(rhat(mcmcr, by = "parameter"), list(alpha = 1, beta = 1.87, sigma = 1))
  expect_equivalent(rhat(mcmcr, by = "term"), list(alpha = c(1, 1), beta = matrix(c(1.85, 1.85, 1.87, 1.87), nrow = 2, ncol = 2), sigma = 1))
})

test_that("rhat.mcmcrs", {
  expect_identical(rhat(mcmcrs_example), list(mcmcr1 = 1.87, mcmcr2 = 1.87))
  expect_identical(rhat(mcmcrs_example, by = "parameter")[[1]], rhat(mcmcrs_example[[1]], by = "parameter"))
})
